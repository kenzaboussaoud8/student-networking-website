<!DOCTYPE html>
<html lang="fr">

<head>
    <link rel="icon" type="image/png" href="/asset/images/heart_logo.png" />
    <title>Love Academy</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link type="text/css" rel="stylesheet" href="../asset/css/style.css">
    <!-- Bootstrap CSS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
</head>

<body>
    <header class="view">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top scrolling-navbar">
            <div class="container">
                <img src="/asset/images/heart_logo.png" alt="logo"
                    style="width:6%; filter: drop-shadow(2mm 4mm 2mm rgb(0, 0, 0));" />
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-link">
                            <button type="button" id="login" name="login" class="btn btn-primary" data-toggle="modal"
                                data-target="#modalLoginForm">Login</button>
                        </li>
                        <li class="nav-link">
                            <button type="button" id="register" name="register" class="btn btn-success"
                                data-toggle="modal" data-target="#modalRegisterForm" type="submit">Register</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Navbar -->
        <!-- Full Page Intro -->
        <div class="row align-items-center" style="position: absolute; z-index: 999; width: 100%;    height: 100%;">
            <h1 class="display-6 col-sm-12"
                style="color: white;opacity: 1; text-align: center; font-family: 'PT Sans Regular', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; text-shadow: 0.1px 0.1px 1px rgb(0, 0, 0), 0 0 0.5em black;">
                Faites de nouvelles rencontres !</h1>
            <div class="mx-auto">
                <a href=""><img style="filter: drop-shadow(0 1.5mm 0.8mm rgb(0, 0, 0)); width: 200px;"
                        src="./asset/images/download-on-app-store.png" alt="IOS" /></a>
                <a href=""><img style="filter: drop-shadow(0 1.5mm 0.8mm rgb(0, 0, 0)); width: 200px;"
                        src="./asset/images/google-chplay.png" alt="Android" /></a>

            </div>
        </div>
        <div class="view home_view"></div>
        <!-- Full Page Intro -->
        <!-- Pop Up Login -->
        <div class="modal fade" id="modalLoginForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <form class="modal-content">
                    <div class="modal-header text-center">
                        <h4 class="modal-title w-100 font-weight-bold">Login</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body mx-2">
                        <div class="md-form mb-3">
                            <i class="fas fa-envelope prefix grey-text"></i>
                            <input type="email" id="email" class="form-control validate">
                            <label data-error="wrong" data-success="right" for="defaultForm-email">Your email</label>
                        </div>

                        <div class="md-form mb-3">
                            <i class="fas fa-lock prefix grey-text"></i>
                            <input type="password" id="password" class="form-control validate">
                            <label data-error="wrong" data-success="right" for="defaultForm-pass">Your password</label>
                            <br>
                            <span id="messageSpan" style="color:red"></span>

                        </div>
                    </div>
                    

                    <div class="modal-footer d-flex justify-content-center">
                        <button class="btn btn-default" type="submit">Login</button>
                    </div>

                </form>
            </div>
        </div>
        <!-- Pop up Login -->
        <!-- Pop Up Register -->
        <div class="modal" id="modalRegisterForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <form class="modal-content">
                    <div class="modal-header text-center">
                        <h4 class="modal-title w-100 font-weight-bold">Sign up</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body mx-3">
                        <div class="md-form mb-2">
                            <i class="fas fa-user prefix grey-text"></i>
                            <input type="text" id="firstname" class="form-control validate">
                            <label data-error="wrong" data-success="right" for="orangeForm-firstname">Your
                                firstname</label>
                        </div>
                        <div class="md-form mb-2">
                            <i class="fas fa-user prefix grey-text"></i>
                            <input type="text" id="lastname" class="form-control validate">
                            <label data-error="wrong" data-success="right" for="orangeForm-lastname">Your
                                lastname</label>
                        </div>
                        <div class="md-form mb-2">
                            <i class="fas fa-envelope prefix grey-text"></i>
                            <input type="email" id="email_register" class="form-control validate">
                            <label data-error="wrong" data-success="right" for="orangeForm-email">Your email</label>
                        </div>
                        <div class="md-form mb-2">
                            <i class="fas fa-lock prefix grey-text"></i>
                            <input type="password" id="password_register" class="form-control validate">
                            <label data-error="wrong" data-success="right" for="orangeForm-pass">Your password</label>
                        </div>
                        <div class="md-form mb-2">
                            <input type="date" id="birthdate" class="form-control">
                            <label class="form-check-label" for="birthdate"></label>
                            <!-- <i class="fas fa-user prefix grey-text"></i>
                            <input type="text" id="orangeForm-birthdate" class="form-control validate date form_datetime"> -->
                            <label data-error="wrong" data-success="right" for="orangeForm-birthdate">Your
                                birthdate</label>
                        </div>
                        <div class="md-form mb-2">

                            <div class="form-check form-check-inline">
                                <input type="radio" class="form-check-input" id="sexeF" name="sexe" value="Femme">
                                <label class="form-check-label" for="materialInline1">Femme</label>
                            </div>

                            <div class="form-check form-check-inline">
                                <input type="radio" class="form-check-input" id="sexeM" name="sexe" value="Homme">
                                <label class="form-check-label" for="materialInline2">Homme</label>
                            </div>


                        </div>
                        <div class="md-form mb-2">
                            <i class="fas fa-user prefix grey-text"></i>
                            <input type="file" class="form-control-file validate" id="studentcard">
                            <label data-error="wrong" data-success="right" for="studentcard">Your student
                                card</label>
                                <br>
                            <span id="SignUpmessageSpan" style="color:red"></span>
                        </div>
                    
                        <div class="modal-footer d-flex justify-content-center">
                            <button class="btn btn-deep-orange" type="submit">Sign up</button>
                        </div>
                </form>
            </div>
        </div>
        <!-- Pop Up Register -->
    </header>
    <!-- Main navigation -->
    <main>
        <section class="mt-5">
            <p class="mx-auto"
                style="text-shadow: 0 0.2em 0.4em rgb(104, 102, 105); text-align: center; font-weight: bold;   font-size: 30px; ">
                Téléchargez notre application disponible pour IOS ou Android</p>
        </section>
    </main>
    <!-- Main navigation -->
    <!--footer Layout-->
    <footer style="margin-top: 100px; background-color: #66B2FF;">
        <p style="padding-top: 20px; padding-left: 600px; display: inline-block;">Copyright KVA Corp</p>
        <p style="padding-left: 150px; display: inline-block;" "><a href=" # ">CGU</a></p>
            <p style=" padding-left: 150px; display: inline-block; ""><a href="#">Mentions légales</a></p>
    </footer>
    <!--footer Layout-->
    <!-- JQuery -->
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <!-- SCRIPTS -->
    <!-- Login -->
    <script>
        (function () {
            $("#modalLoginForm").submit(function (e) {
                e.preventDefault();
                $.ajax({
                    url: 'http://localhost:8080/login',
                    type: 'POST',
                    withCredentials: true,
                    data: {
                        email: $("input[id='email']").val(),
                        password: $("input[id='password']").val(),
                    },
                    statusCode:{
                        200: function(){
                            $("#messageSpan").text("Login successful.");
                        },
                        404: function(){
                            $("#messageSpan").text("Email does not exist. Please sign up!");
                        },
                         401: function(){
                            $("#messageSpan").text("Invalid credentials. Please try again");
                        },
                        400: function(){
                            $("#messageSpan").text("Missing required field");
                        }
                    
                }
                }).done(function (res) {
                    //token recupéré ici, localStorage
                    localStorage.setItem("token", res.tokens.token);
                    // redirection
                    window.location("")
                })
            })
        }
        )();
    </script>
    <!-- Register -->
    <script>
        (function () {
            $("#modalRegisterForm").submit(function (e) {
                e.preventDefault();
                $.ajax({
                    url: 'http://localhost:8080/register',
                    type: 'POST',

                    data: {
                        password: $("input[id='password_register']").val(),
                        first_name: $("input[id='firstname']").val(),
                        last_name: $("input[id='lastname']").val(),
                        email: $("input[id='email_register']").val(),
                        gender: $("input[name='sexe']:checked").val(),
                        birth_date: $("input[id='birthdate']").val(),
                        student_card: $("input[id='studentcard']").val()

                    },
                    statusCode:{
                        200: function(){
                            $("#SignUpmessageSpan").text("Registration successful.");
                        },
                        401: function(){
                            $("#SignUpmessageSpan").text("Missing one of many required information");
                        },
                         404: function(){
                            $("#SignUpmessageSpan").text("Invalid fields. Please try again");
                        },
                        400: function(){
                            $("#SignUpmessageSpan").text("User already exists");
                        }
                    
                }
                }).done(function (data){
                    console.log('You are registered')
                    localStorage.setItem("token", res.tokens.token);
                    alert("You've been sent an email! Go check :)");
                })
        })
        }
        ) ();
    </script>

    <!-- Si le user a déjà un token, on le log automatiquement -->
    <script>
        $(document).ready(function () {
            // on récupère le token depuis le localStorage
            let tk = localStorage.getItem("token");
            $.ajax({
                url: 'http://localhost:8080/user/' + tk,
                type: 'GET',
            }).done(function (dt) {
                console.log("You've been automatically logged")
                $(".card-deck").css("display", "none")
                $("#add").css("display", "block");
            })
        });
    </script>
    <!-- Script de déconnexion -->
    <script>
        (function () {
            $("#logout").click(function (e) {
                // on récupère le token depuis le localStorage
                let tk = localStorage.getItem("token");
                e.preventDefault();
                $.ajax({
                    url: 'http://localhost:8080/user/' + tk,
                    type: 'DELETE',
                    data: {
                        token: tk
                    }
                }).done(function (data) {
                    console.log('Logged out!')
                    window.location.href = 'index.html';
                })
            })
        }
        )();
    </script>
</body>

</html>